package emp.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.sql.Date;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import emp.dto.EmpDTO;
import emp.service.EmpService;

@WebServlet("/add")
public class EmpAddController extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html; charset=UTF-8");
        PrintWriter out = response.getWriter();

        out.println("<!DOCTYPE html>");
        out.println("<html>");
        out.println("<head>");
        out.println("<meta charset='UTF-8'>");
        out.println("<title>사원 추가</title>");
        out.println("</head>");
        out.println("<body>");
        out.println("<h2>사원 등록</h2>");
        out.println("<form method='post' action='add'>");
        out.println("이름: <input type='text' name='ename'><br>");
        out.println("직무: <input type='text' name='job'><br>");
        out.println("매니저번호: <input type='number' name='mgr'><br>");
        out.println("입사일: <input type='date' name='hiredate'><br>");
        out.println("급여: <input type='number' name='sal'><br>");
        out.println("커미션: <input type='number' name='comm'><br>");
        out.println("부서번호: <input type='number' name='deptno'><br>");
        out.println("<input type='submit' value='등록'>");
        out.println("</form>");
        out.println("</body>");
        out.println("</html>");
    }
	

	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		EmpDTO dto = new EmpDTO();
		try {

			String ename = request.getParameter("ename");
			dto.setEname(ename);
			
			String job = request.getParameter("job");
			dto.setJob(job);
			
			String sMgr = request.getParameter("mgr");
			int mgr = Integer.parseInt(sMgr);
			dto.setMgr(mgr);
			
			String sHiredate = request.getParameter("hiredate");
			Date hiredate = Date.valueOf(sHiredate);
			dto.setHiredate(hiredate);
			
			String sSal = request.getParameter("sal");
			int sal = Integer.parseInt(sSal);
			dto.setSal(sal);
			
			String sComm = request.getParameter("comm");
			int comm = Integer.parseInt(sComm);
			dto.setComm(comm);
			
			String sDeptno = request.getParameter("deptno");
			int deptno = Integer.parseInt(sDeptno);
			dto.setDeptno(deptno);
			
			
			//db삽입
			EmpService empService = new EmpService();

			int result = empService.addEmp(dto);
			System.out.println("result = " +result);
			response.sendRedirect("list");
			
			
			

			
			
		} catch(Exception e) {
			e.printStackTrace();
		}
		

		
	}
	
	//파라미터 String값을 줌,
	//만약에 원래 String이라면 String을 돌려줌
	//원래 int 라면 int를 돌려주게 getclass.getname
	
	//오버라이드 해서 자료형을 반환하는 메소드는 안되나?????

	
//	private Object getParam(String param) {
//		Object o = param;
//		try {
//			String sEmpno = request.getParameter("empno");
//			dto.setEmpno((int)getParam(sEmpno));
//			
//			
//		}catch (Exception e) {
//			e.printStackTrace();
//		}
//	}
	

}
